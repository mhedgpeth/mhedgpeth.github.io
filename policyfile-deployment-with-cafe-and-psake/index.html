<!doctype html><html prefix="og: http://ogp.me/ns#" lang=en-us><head itemscope itemtype=https://hedge-ops.com/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:locale" content="en"><meta name=language content="en"><title itemprop=name>Policyfile Deployment with Cafe and Psake &#183; Michael Hedgpeth</title><meta property="og:title" content="Policyfile Deployment with Cafe and Psake &#183; Michael Hedgpeth"><meta name=twitter:title content="Policyfile Deployment with Cafe and Psake &#183; Michael Hedgpeth"><meta itemprop=name content="Policyfile Deployment with Cafe and Psake &#183; Michael Hedgpeth"><meta name=application-name content="Michael Hedgpeth"><meta property="og:site_name" content="Michael Hedgpeth"><base href=https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/><link rel=canonical href=https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/ itemprop=url><meta name=url content="https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/"><meta name=twitter:url content="https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/"><meta property="og:url" content="https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/"><meta itemprop=image content="https://hedge-ops.com/images/michael.jpg"><meta property="og:image" content="https://hedge-ops.com/images/michael.jpg"><meta name=twitter:image content="https://hedge-ops.com/images/michael.jpg"><meta name=twitter:image:src content="https://hedge-ops.com/images/michael.jpg"><meta name=twitter:card content="summary_large_image"><meta property="og:type" content="article"><meta itemprop=description content="Our cookbook builds make a pipeline which places them into a private supermarket. Then separate policyfile repository pipelines grouped by product get uploaded"><meta property="og:description" content="Our cookbook builds make a pipeline which places them into a private supermarket. Then separate policyfile repository pipelines grouped by product get uploaded"><meta name=description content="Our cookbook builds make a pipeline which places them into a private supermarket. Then separate policyfile repository pipelines grouped by product get uploaded"><meta name=twitter:description content="Our cookbook builds make a pipeline which places them into a private supermarket. Then separate policyfile repository pipelines grouped by product get uploaded"><meta property="article:published_time" content="2017-05-16T00:00:00Z"><meta name=twitter:label1 value="Reading time"><meta name=twitter:data1 value="4 minutes"><meta name=twitter:label2 value=Published><meta name=twitter:data2 value="May 16, 2017"><meta property="article:tag" content="cafe"><meta property="article:tag" content="chef"><meta property="og:updated_time" content="2017-05-16T00:00:00Z"><meta property="og:article:author" content="Michael"><meta property="article:author" content="Michael"><meta name=author content="Michael"><meta name=generator content="Hugo 0.72.0"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet href=https://hedge-ops.com/css/styles.min.ef433e47a104e30937dfad230e28b6dd329c9b4fe18ff4925850da1f24df3133.css integrity="sha256-70M+R6EE4wk3360jDii23TKcm0/hj/SSWFDaHyTfMTM="><link href=/index.xml rel=alternate type=application/rss+xml title="Michael Hedgpeth"><script src=https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js></script></head><body class="bg-gradient flex flex-col min-h-screen"><header id=header class="w-full m-0 fixed z-10 transition-all duration-300 ease-in-out border-t-4 border-gray-300 backdrop-filter-blur"><div id=header-container class="max-w-7xl mx-auto p-6 flex items-center flex-wrap lg:flex-no-wrap relative justify-between"><a href=https://hedge-ops.com/ class="tracking-tighter leading-10 text-3xl font-semibold text-gray-600 flex flex-shrink-0">Michael Hedgpeth</a><div class="block lg:hidden mx-2"><button class="nav-button w-10 h-10 justify-center flex items-center opacity-75 hover:opacity-100 transition duration-300 ease-in-out"><svg class="fill-current h-4 w-4" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/></svg></button>
<button class="hidden nav-button w-10 h-10 justify-center flex items-center opacity-75 hover:opacity-100 transition duration-300 ease-in-out"><svg class="fill-current h-4 w-4" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Close menu</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></button></div><div class="absolute right-8 top-16 lg:relative lg:right-0 lg:top-0 flex flex-col lg:flex-row items-center rounded-md bg-white shadow lg:bg-transparent lg:shadow-none"><nav id=nav-social-links class="p-4 lg:p-0 text-gray-600 hidden lg:block lg:order-last w-full lg:w-auto lg:ml-3"><ul class="flex justify-end"><li><a class="block p-2 opacity-75 hover:opacity-100 transition duration-300 ease-in-out" title=Twitter href=https://www.twitter.com/michaelhedgpeth rel=me><svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Twitter</title><path d="M6.29 18.25c7.55.0 11.67-6.25 11.67-11.67v-.53c.8-.59 1.49-1.3 2.04-2.13-.75.33-1.54.55-2.36.65a4.12 4.12.0 001.8-2.27c-.8.48-1.68.81-2.6 1a4.1 4.1.0 00-7 3.74 11.65 11.65.0 01-8.45-4.3 4.1 4.1.0 001.27 5.49C2.01 8.2 1.37 8.03.8 7.7v.05a4.1 4.1.0 003.3 4.03 4.1 4.1.0 01-1.86.07 4.1 4.1.0 003.83 2.85A8.23 8.23.0 010 16.4a11.62 11.62.0 006.29 1.84"/></svg></a></li><li><a class="block p-2 opacity-75 hover:opacity-100 transition duration-300 ease-in-out" title=Github href=https://www.github.com/mhedgpeth rel=me><svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0A10 10 0 006.84 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94.0-1.1.39-1.99 1.03-2.69a3.6 3.6.0 01.1-2.64s.84-.27 2.75 1.02a9.58 9.58.0 015 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69.0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0010 0"/></svg></a></li><li><a class="block p-2 opacity-75 hover:opacity-100 transition duration-300 ease-in-out" title=Linkedin href=https://linkedin.com/in/michael-hedgpeth rel=me><svg class="fill-current w-5 h-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a></li><li><a class="block p-2 opacity-75 hover:opacity-100 transition duration-300 ease-in-out" title=Feed href=/index.xml><svg class="fill-current w-5 h-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>RSS</title><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></a></li></ul></nav><nav id=nav-menu class="p-4 lg:p-0 hidden lg:block w-full lg:w-auto text-gray-600"><ul class="w-full flex flex-col lg:flex-row justify-end items-end lg:items-center"><li class="flex my-2 lg:my-2 mx-1 lg:mx-2"><a title=About class="uppercase font-bold lg:py-2 lg:px-3 rounded text-sm opacity-75 hover:opacity-100 transition duration-300 ease-in-out" href=/about>About</a></li><li class="flex my-2 lg:my-2 mx-1 lg:mx-2"><a title=Speaking class="uppercase font-bold lg:py-2 lg:px-3 rounded text-sm opacity-75 hover:opacity-100 transition duration-300 ease-in-out" href=/speaking>Speaking</a></li></ul></nav></div></div></header><main class="flex-1 mt-12 max-w-3xl mt-32 mx-auto text-gray-700 w-full"><div id=reading-progress-bar role=presentation class="fixed z-10 top-0 left-0 h-1 bg-gray-700"></div><article class=article><header class="text-center pt-10 pb-6"><small class="text-center text-sm"><time class=text-gray-500 datetime=2017-05-16T00:00:00+00:00>May 16, 2017</time>
<a href=https://hedge-ops.com/tags/chef/ class="inline-flex items-center px-4 py-1 rounded-full no-underline bg-orange-100 text-orange-800 hover:bg-orange-300 ml-4">chef</a>
<a href=https://hedge-ops.com/tags/cafe/ class="inline-flex items-center px-4 py-1 rounded-full no-underline bg-orange-100 text-orange-800 hover:bg-orange-300 ml-4">cafe</a></small><h1 class="leading-9 text-center"><a href=https://hedge-ops.com/policyfile-deployment-with-cafe-and-psake/ class="no-underline inline-block text-black relative"><div class=dots aria-hidden=true></div>Policyfile Deployment with Cafe and Psake</a></h1></header><div class=article__content><div class=full-width><img src=/images/feature-policyfile-deployment-with-cafe-and-psake.jpg alt="Policyfile Deployment with Cafe"></div><p>Our <a href=/cookbook-development-with-rakefile/>cookbook builds</a> make a <a href=/cookbook-pipeline-with-jenkinsfile/>pipeline</a> which places them into a private supermarket. Then separate <a href=/policyfile-pipeline-with-jenkinsfile/>policyfile repository pipelines</a> grouped by product get uploaded to an artifactory server.</p><p>Now for the exciting part: In an air-gapped environment, we can easily update all the things chef-related and do that within a transactional interaction with the Chef Server and all of its nodes.</p><p>This is the part where my project <a href=/introducing-cafe/>cafe</a> really shines. In this situation where you&rsquo;re rolling out a <a href=/policyfiles/>policy</a> to a Chef Server, you might have a lot of issues; you might have to wait an indeterminate time for chef to run on each node. You may not be able to predict if all the right policies hit the nodes when they run next. It&rsquo;s a very scary moment.</p><p>But we can automate that crazy situation and make it a peaceful, good situation. We do that with cafe and <a href=https://github.com/psake/psake>psake</a> a powershell-based automation mechanism.</p><p>Why psake? Within our windows-heavy environment people want to see powershell. So it makes sense for us to orchestrate our deployment of chef changes with a powershell-based mechanism. If I was in a ruby shop I&rsquo;d probably use rake. Whatever it takes; the main requirements are that it be a staged model where if a stage fails then the execution stops. Pretty much any make-based system will do that.</p><h1 id=psake-deployment-script-with-cafe>Psake Deployment Script with Cafe</h1><p>So let&rsquo;s jump into our <code>deploy.ps1</code> which is our script to deploy all the things to the Chef Server and rerun Chef on all the servers:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>properties {
  <span style=color:#998;font-style:italic>#put properties here like servers</span>
  <span style=color:teal>$servers</span> = @( <span style=color:#d14>&#39;database-server&#39;</span>, <span style=color:#d14>&#39;webserver&#39;</span>)
  <span style=color:teal>$policy_group</span> = <span style=color:#d14>&#39;qa&#39;</span>
  <span style=color:teal>$product_prefix</span> = <span style=color:#d14>&#39;myproduct&#39;</span>
}
Task <span style=color:#000;font-weight:700>default</span> -description <span style=color:#d14>&#34;runs a full deployment&#34;</span> `
-depends PauseChef, UpdatePolicies, ConvergeNodes, ResumeChef

Task PauseChef -description <span style=color:#d14>&#34;pauses chef across all nodes using cafe&#34;</span> {
  <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$server</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$servers</span>) {
    exec { <span style=color:#0086b3>Invoke-Expression</span> <span style=color:#d14>&#34;C:\cafe\cafe.exe chef pause on: $server&#34;</span> }
  }
}

Task UpdatePolicies -description <span style=color:#d14>&#34;Updates the Policies on the Chef Server&#34;</span> {
 <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$policyfile</span> <span style=color:#000;font-weight:700>in</span> <span style=color:#0086b3>Get-ChildItem</span> -Filter *.tgz) {
    <span style=color:#0086b3>Write-Host</span> <span style=color:#d14>&#34;Uploading $policyfile to $policy_group&#34;</span>
    exec { <span style=color:#0086b3>Invoke-Expression</span> <span style=color:#d14>&#34;chef push-archive $policy_group $policyfile&#34;</span> }
  }
}

Task ConvergeNodes -description <span style=color:#d14>&#34;Runs Chef on all nodes&#34;</span> {
  <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$server</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$servers</span>) {
    exec { <span style=color:#0086b3>Invoke-Expression</span> <span style=color:#d14>&#34;C:\cafe\cafe.exe chef run on: $server&#34;</span> }
  }
}

Task ResumeChef -description <span style=color:#d14>&#34;Resumes Chef across all nodes using cafe&#34;</span> {
  <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$server</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$servers</span>) {
    exec { <span style=color:#0086b3>Invoke-Expression</span> <span style=color:#d14>&#34;C:\cafe\cafe.exe chef resume on: $server&#34;</span> }
  }
}
</code></pre></div><p>I really love how readable and self-documenting this is. So much so, that I don&rsquo;t feel like I have to explain it. What I will say is that we follow this workflow:</p><ol><li>Pause Chef (get into maintenance mode)</li><li>Push policies to Chef Server</li><li>Converge All Nodes</li><li>Resume Chef</li></ol><p>The control and safety here should make every Chef user giddy with excitement. This change event is so scary, that you need safety around it. Coupled with Policyfiles, cafe brings you that safety, and if you agree I would love your help making cafe everything it should be within the Chef ecosystem.</p><h1 id=pipeline-for-deployment>Pipeline for Deployment</h1><p>If you&rsquo;ll remember from the <a href=/policyfile-pipeline-with-jenkinsfile/>policyfile pipeline</a> post, everything described above is packaged <strong>with</strong> the policyfile archives. So this is the script that runs within the context of those other files. We have <strong>one package</strong>, versioned by Jenkins, that we can upload to do an atomic update of everything related to Chef, then reconverge the nodes.</p><p>So now that we have this file available on our artifacts server, it&rsquo;s time to run a deployment. With an air-gapped environment, the source of these files might be different, or you might get those files to their destination in a variety of ways. However, the basics remain the same from a pipeline perspective: you need to download the file, unzip it, and run the script. Here is an example <code>Jenkinsfile</code> that does just this:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>archiveName <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;myproduct_policies_${policiesVersion}.zip&#34;</span>
stage<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Download&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  node<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;windows&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    bat <span style=color:#d14>&#39;del /F /Q *.*&#39;</span>
    bat <span style=color:#d14>&#34;jfrog.exe rt download myproduct-repo/myproduct-policies/${archiveName} ${archiveName} --flat=true&#34;</span>
    bat <span style=color:#d14>&#34;\&#34;C:\\Program Files\\7-Zip\\7z.exe\&#34; x ${archiveName}&#34;</span>
    stash <span style=color:#d14>&#39;everything&#39;</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#458;font-weight:700>def</span> <span style=color:#900;font-weight:700>powershell</span><span style=color:#000;font-weight:700>(</span>command<span style=color:#000;font-weight:700>){</span>
  ansiColor<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#39;xterm&#39;</span><span style=color:#000;font-weight:700>){</span>
    print <span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;${(char)27}[33m  ${new Date()} Executing :: ${command}&#34;</span><span style=color:#000;font-weight:700>)</span>
    bat <span style=color:#d14>&#34;powershell.exe -Command \&#34;${command}\&#34;&#34;</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#458;font-weight:700>def</span> <span style=color:#900;font-weight:700>invoke_psake</span><span style=color:#000;font-weight:700>(){</span>
  powershell<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;.\\psake.ps1 .\\deploy.ps1&#34;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
stage<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Deploy&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  node<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;windows&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    unstash <span style=color:#d14>&#39;everything&#39;</span>
    invoke_psake<span style=color:#000;font-weight:700>()</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>It&rsquo;s as simple as that. In Jenkins we make <code>policiesVersion</code> a parameter and all of the sudden we have a parameterized build of versioned grouped policies that happen in an ATOMIC update, with immediate node convergence.</p><h1 id=conclusion>Conclusion</h1><p>I love taking the complexity of all those Chef scripts, on all those nodes, and narrowing them down to a single file that gets deployed to a target environment. This is exactly what the developers have been doing for some time; it&rsquo;s nice to see my Chef workflow catch up with that goodness. In a change management situation, it&rsquo;s <em>very clear</em> what&rsquo;s happening here.</p><p>One improvement I want to make soon: I&rsquo;d like to have a file checksum added as a parameter to the Jenkins job. That way if someone accidentally fat fingered the wrong version, you wouldn&rsquo;t accidentally get the wrong version deployed. Everything needs a safety net.</p></div><section class="my-5 pt-10 pb-5 border-t border-gray-400 flex items-center"><img alt="Avatar photo" class="border border-gray-400 p-1 w-10 h-10 rounded-full mr-3" src=/images/michael.jpg>
<span class=flex-grow>Michael Hedgpeth</span>
<a href="http://twitter.com/share?url=https%3a%2f%2fhedge-ops.com%2fpolicyfile-deployment-with-cafe-and-psake%2f&text=Policyfile%20Deployment%20with%20Cafe%20and%20Psake&via=michaelhedgpeth" class="text-white text-xs font-bold rounded-md no-underline flex items-center px-3 py-2 bg-twitter hover:color-white hover:opacity-75 no-underline"><svg class="fill-current w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Twitter</title><path d="M6.29 18.25c7.55.0 11.67-6.25 11.67-11.67v-.53c.8-.59 1.49-1.3 2.04-2.13-.75.33-1.54.55-2.36.65a4.12 4.12.0 001.8-2.27c-.8.48-1.68.81-2.6 1a4.1 4.1.0 00-7 3.74 11.65 11.65.0 01-8.45-4.3 4.1 4.1.0 001.27 5.49C2.01 8.2 1.37 8.03.8 7.7v.05a4.1 4.1.0 003.3 4.03 4.1 4.1.0 01-1.86.07 4.1 4.1.0 003.83 2.85A8.23 8.23.0 010 16.4a11.62 11.62.0 006.29 1.84"/></svg>Tweet</a></section><section class="my-5 py-5 relative"><h2>Interactions</h2></section></article><aside class=flex><a class="w-full md:w-1/2 flex flex-col items-center py-7 px-3 no-underline rounded-md hover:bg-white transition duration-300 ease-in-out" href=/cafe-cookbook/><span class="border border-gray-6 text-xs rounded-md mb-2 uppercase font-bold py-2 px-3">Read this next</span>
<span class=text-center>Cafe Cookbook</span></a>
<a class="w-full md:w-1/2 flex flex-col items-center py-7 px-3 no-underline rounded-md hover:bg-white transition duration-300 ease-in-out" href=/policyfile-pipeline-with-jenkinsfile/><span class="border border-gray-6 text-xs rounded-md mb-2 uppercase font-bold py-2 px-3">You might enjoy</span>
<span class=text-center>Policyfile Pipeline with Jenkinsfile</span></a></aside></main><footer class="w-full max-w-7xl mx-auto text-center border-t border-gray-200 py-9 px-3 mt-9 pin-b text-sm text-gray-500">Made with <a href=https://gohugo.io class="underline transition duration-300 ease-in-out hover:text-blue-600">Hugo</a> and <a href=https://github.com/leonardofaria/bento class="underline transition duration-300 ease-in-out hover:text-blue-600">Bento theme</a>.
Copyright © 2020 Michael Hedgpeth</footer><script>var initMenu=()=>{var navButtons=document.querySelectorAll('.nav-button');var navMenu=document.querySelector('#nav-menu');var navSocialLinks=document.querySelector('#nav-social-links');for(var button of navButtons){button.addEventListener('click',()=>{console.log('click')
navMenu.classList.toggle("hidden");if(navSocialLinks){navSocialLinks.classList.toggle("hidden");}
for(var navButton of navButtons){navButton.classList.toggle("hidden");};});}}
document.addEventListener('turbolinks:load',initMenu());</script><script>var initHeader=()=>{let scrollPos=window.scrollY;var header=document.querySelector('#header');var headerContainer=document.querySelector("#header-container");var readingProgressBar=document.querySelector("#reading-progress-bar");let scrollTop=0;let scrollBottom=0;let scrollPercent=0;var addClassOnScroll=()=>{header.classList.add("shadow");header.classList.add("bg-white-90");}
var removeClassOnScroll=()=>{header.classList.remove("shadow");header.classList.remove("bg-white-90");}
window.onscroll=function(){scrollPos=window.scrollY;scrollTop=document.documentElement["scrollTop"]||document.body["scrollTop"];scrollBottom=(document.documentElement["scrollHeight"]||document.body["scrollHeight"])-document.documentElement.clientHeight;scrollPercent=scrollTop/scrollBottom*100;readingProgressBar.style.width=(scrollTop/scrollBottom*100)+'%';if(scrollPos>0){addClassOnScroll()}
else{removeClassOnScroll()}}}
document.addEventListener('turbolinks:load',initHeader());</script></body></html>